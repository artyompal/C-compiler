
 TODO:


 Fixes:

 * Надо разрешить регистровым переменным участвовать в int2float/float2int в случае включённого SSE.

 * Надо учитывать использование инструкциями mul/div/idiv/cdq соответствующих регистров.

 * Можно выделять регистры из числа вышедших из употребления в правой части этой же инструкции.

 * Надо выделять свободный регистр сначала из неживых регистров, и только потом вытеснять живые.

 * Заменить табы в листинге на пробелы.

 * Изменить нумерацию esp/ebp во внутреннем представлении компилятора.


 Ядро кодогенератора/оптимизатора:

 * Надо написать функцию клонирования всего кода функции.

 * Надо написать оценочную функцию для примерного вычисления времени выполнения функции.
   После этого станет возможно перебирать варианты кодогенерации.

 * Надо написать вытеснение регистров eax/edx для нужд mul/div/idiv.
   Тогда можно будет избавиться от хардкода в аллокаторе регистров.

 * Надо условно определять оптимальный регистр для регистровых переменных: ebx/esi/edi или eax/ecx/edx.

 * Надо написать распространение копирований.
   Тогда можно будет убрать все хакерские оптимизации регистровых переменных.

 * Нужно вынести константные вычисления из цикла.

 * Надо написать устранение общих подвыражений.


 Дополнительно:

 * Надо написать обнаружение циклов. Желательно детектировать количество итераций в простейших циклах.
   После этого станет возможно усовершенствовать оценочную функцию.

 * Можно улучшить алгоритм вытеснения регистров, если регистры, которые можно просто загрузить из памяти, не сохранять.

 * Можно улучшить алгоритм вытеснения регистров, имея оценочную функцию с информацией о внутренних циклах,
   с тем, чтобы не помещать код сохранения/восстановления регистра во внутренний цикл.

 * Нужно написать проверку графа на приводимость.

 * Можно также освободить регистр ebp, если отказаться от стек-фреймов в статических функциях.
   Можно одним проходом после инлайнинга перевести всю адресацию с ebp на esp.

 * Нужно заменять вещественные деления на константу на умножения.


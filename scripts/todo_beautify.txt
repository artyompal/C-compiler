
=======================================================
__rasterize_horiz_line proc
        push    ebp
        mov     ebp,esp
        sub     esp,96
        push    edi
        push    esi
        push    ebx
        movss   xmm7,dword ptr [ebp+32]
        movss   xmm6,dword ptr [ebp+28]
        movss   xmm5,dword ptr [ebp+24]
        movss   xmm4,dword ptr [ebp+20]
        mov     edi,[ebp+16]
        mov     esi,[ebp+12]
        mov     ebx,[ebp+8]
        mov     edx,dword ptr [__pitch]
        imul    edx,edi
        add     edx,dword ptr [__videomem]
        mov     edi,ebx
        sal     edi,2
        add     edx,edi
        mov     edi,esi
        sal     edi,2
        add     edi,edx
        sal     ebx,2
        sub     edi,ebx
        mov     [ebp-68],edx
        mov     [ebp-72],edi
        movss   dword ptr [ebp-84],xmm4
        movss   dword ptr [ebp-88],xmm5
        movss   dword ptr [ebp-92],xmm6
        movss   dword ptr [ebp-96],xmm7
label0000:                                                ;
; start of inline function _tex2d                         ;
        movss   xmm7,dword ptr [ebp-88]                   ; 1 лишние копирования, поможет распространение копирований
        movss   xmm6,dword ptr [ebp-84]                   ; 1 
        mov     eax,dword ptr [__texture_width]           ; 2 константные выражения в цикле
        dec     eax                                       ; 2
        cvtsi2ss        xmm0,eax                          ; 2
        mulss   xmm0,xmm6                                 ;
        cvttss2si       eax,xmm0                          ; 2
        mov     ecx,dword ptr [__texture_height]          ; 2
        dec     ecx                                       ; 2
        cvtsi2ss        xmm0,ecx                          ; 2
        mulss   xmm0,xmm7                                 ; 2
        cvttss2si       ecx,xmm0                          ; 2
        imul    ecx,dword ptr [__texture_width]           ; 2
        add     ecx,eax                                   ; 3 можно вместить в режимы адресации x86
        sal     ecx,2                                     ; 3
        add     ecx,dword ptr [__texture_data]            ; 3
        mov     ecx,[ecx]                                 ; 3
; end of inline function _tex2d                           ;
        mov     eax,ecx                                   ;
        sar     eax,24                                    ;
        and     eax,255                                   ;
        cmp     eax,0                                     ; 4 cmp,0/je бессмысленен после арифметической операции
        mov     [ebp-76],ecx                              ; 5 лишние сохранения регистров
        mov     [ebp-80],eax                              ; 5
        je      label0003                                 ;
        cvtsi2ss        xmm7,dword ptr [ebp-80]           ;
        divss   xmm7,dword ptr [___unnamed_float_6]       ; 6 деление на константу можно было заменить на умножение
        mov     edx,[ebp-68]                              ; 7 лишнее восстановление регистра
        mov     edi,[edx]                                 ;
        mov     esi,edi                                   ;
        and     esi,65280                                 ;
        sar     esi,8                                     ;
        and     edi,255                                   ;
        mov     ebx,[ebp-76]                              ; 7 лишнее восстановление регистра
        and     ebx,65280                                 ;
        sar     ebx,8                                     ;
        mov     ecx,[ebp-76]                              ; 7 лишнее восстановление регистра
        and     ecx,255                                   ;
        cvtsi2ss        xmm0,ebx                          ;
        mulss   xmm0,xmm7                                 ;
        cvtsi2ss        xmm1,esi                          ;
        movss   xmm2,dword ptr [___unnamed_float_1]       ;
        subss   xmm2,xmm7                                 ;
        mulss   xmm1,xmm2                                 ;
        addss   xmm0,xmm1                                 ;
        cvttss2si       ebx,xmm0                          ;
        cvtsi2ss        xmm0,ecx                          ;
        mulss   xmm0,xmm7                                 ;
        cvtsi2ss        xmm1,edi                          ;
        movss   xmm2,dword ptr [___unnamed_float_1]       ;
        subss   xmm2,xmm7                                 ;
        mulss   xmm1,xmm2                                 ;
        addss   xmm0,xmm1                                 ;
        cvttss2si       ecx,xmm0                          ;
        mov     edi,ebx                                   ;
        sal     edi,8                                     ;
        add     edi,ecx                                   ;
        mov     [edx],edi                                 ;
label0003:                                                ;
        movss   xmm4,dword ptr [ebp-84]                   ; 7 лишнее восстановление регистра
        addss   xmm4,dword ptr [ebp-92]                   ;
        movss   xmm5,dword ptr [ebp-88]                   ; 7 лишнее восстановление регистра
        addss   xmm5,dword ptr [ebp-96]                   ;
        mov     edx,[ebp-68]                              ; 7 лишнее восстановление регистра
        add     edx,4                                     ;
        cmp     edx,[ebp-72]                              ;
        mov     [ebp-68],edx                              ; 8 лишние сохранения регистров
        movss   dword ptr [ebp-84],xmm4                   ; 8
        movss   dword ptr [ebp-88],xmm5                   ; 8
        jl      label0000                                 ;
        pop     ebx
        pop     esi
        pop     edi
        add     esp,96
        pop     ebp
        ret
__rasterize_horiz_line endp     
=======================================================
